name: Github Actions Workflow

on:
  pull_request:
    types: [opened, reopened, ready_for_review, synchronize]
  pull_request_target:
    types: [opened, reopened, ready_for_review]

permissions:
  pull-requests: write
  issues: write
  contents: read

jobs:
  auto-assign:
    runs-on: ubuntu-latest
    if: github.event.pull_request.draft == false

    steps:
      - name: Checkout code
        uses: actions/checkout@v5
        with:
          fetch-depth: 0

      - name: Auto Assign & Request Reviews ü§ñ
        uses: actions/github-script@v7
        with:
          script: |
            const pr = context.payload.pull_request;
            const author = pr.user.login;

            console.log(`üü£ Processing PR #${pr.number} by @${author}`);

            // 1Ô∏è‚É£ Assign PR to author
            try {
              await github.rest.issues.addAssignees({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: pr.number,
                assignees: [author]
              });
              console.log(`‚úÖ Assigned PR to author: @${author}`);
            } catch (error) {
              console.log(`‚ö†Ô∏è Could not assign PR: ${error.message}`);
            }

            // 2Ô∏è‚É£ Always request reviews from main reviewers
            const reviewers = ['acbytgbrk', 'fatihcimen'];

            try {
              await github.rest.pulls.requestReviewers({
                owner: context.repo.owner,
                repo: context.repo.repo,
                pull_number: pr.number,
                reviewers
              });
              console.log(`‚úÖ Requested reviews from: ${reviewers.join(', ')}`);
            } catch (error) {
              console.log(`‚ö†Ô∏è Error requesting reviewers: ${error.message}`);
            }

            // 3Ô∏è‚É£ Add a friendly comment when PR is opened
            if (context.payload.action === 'opened') {
              const body = [
                `üëã Hey @${author}, welcome to the PR!`,
                `This pull request will be reviewed by our main reviewers: **@acbytgbrk** and **@fatihcimen**.`,
                ``,
                `üìä **Quick stats:**`,
                `‚Ä¢ Title: ${pr.title}`,
                `‚Ä¢ Branch: ${pr.head.ref}`,
                `‚Ä¢ Changes: +${pr.additions} / -${pr.deletions}`,
                ``,
                `_Auto-review assignment by GitHub Actions ü§ñ_`
              ].join('\n');

              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: pr.number,
                body
              });

              console.log('üí¨ Added welcome comment to PR.');
            }

